<div class="container">
  <h1>Dashboard de Produtos</h1>

  <div class="cards">
    <div class="card">
      <h3>Total de Produtos</h3>
      <p>{{ totalProdutos }}</p>
    </div>

    <div class="card">
      <h3>Produtos Ativos</h3>
      <p>{{ produtosAtivos }}</p>
    </div>

    <div class="card">
      <h3>Produtos Inativos</h3>
      <p>{{ produtosInativos }}</p>
    </div>

    <div class="card">
      <h3>Valor em Estoque</h3>
      <p>{{ valorEstoque | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}</p>
    </div>
  </div>

  <div class="graficos">
    <div class="grafico">
      <h3>Produtos por Categoria</h3>
      @for (cat of categoriasResumo; track cat.nome; let i = $index) {
        <div class="barra">
          <span class="label">{{ cat.nome }}</span>

          <div class="barra-externa">
            <div
              class="barra-interna"
              [style.width.%]="cat.percentual"
              [style.background]="cores[i % cores.length]">
            </div>
          </div>
          <span class="valor">{{ cat.quantidade }}</span>
        </div>
      } @empty {
        <p>Sem dados de categoria.</p>
      } 
    </div>

    <div class="grafico">
      <h3>Ativos x Inativos</h3>
      <div class="status">
        <span>Ativos</span>
        <div class="barra-externa">
          <div class="barra-interna ativo" [style.width.%]="percentualAtivos"></div>
        </div>
        <span>{{ percentualAtivos | number:'1.0-0' }}%</span>
      </div>

      <div class="status">
        <span>Inativos</span>
        <div class="barra-externa">
          <div class="barra-interna inativo" [style.width.%]="percentualInativos"></div>
        </div>
        <span>{{ percentualInativos | number:'1.0-0' }}%</span>
      </div>
    </div>
  </div>

  <div class="listas">
    <div class="painel">
      <h3>Produtos com Baixo Estoque</h3>
      <table>
        <thead>
          <tr>
            <th>Produto</th>
            <th>Categoria</th>
            <th>Estoque</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          @for (p of estoqueBaixo.slice(0, 5); track p.id) {
            <tr>
              <td>{{ p.nome }}</td>
              <td>{{ p.categoria }}</td>
              <td>{{ p.quantidadeEstoque }}</td>
              <td><p-tag [value]="getStatusLabel(p.quantidadeEstoque)" [severity]="getSeverity(p.quantidadeEstoque)"/></td>
            </tr>
          } @empty {
            <tr>
              <td colspan="4">Estoque em dia!</td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <div class="painel">
      <h3>Últimos Produtos Cadastrados</h3>
      <table>
        <thead>
          <tr>
            <th>Nome</th>
            <th>Categoria</th>
            <th>Preço</th>
            <th>Estoque</th>
            <th>Ativo</th>
          </tr>
        </thead>
        <tbody>
          @for (p of produtos.slice(-5).reverse(); track p.id) {
            <tr>
              <td>{{ p.nome }}</td>
              <td>{{ p.categoria }}</td>
              <td>{{ p.preco | currency:'BRL' }}</td>
              <td>{{ p.quantidadeEstoque }}</td>
              <td>
                <p-tag 
                  [icon]="p.ativo ? 'pi pi-check' : 'pi pi-times'" 
                  [severity]="p.ativo ? 'success' : 'danger'" 
                  [value]="p.ativo ? 'Ativo' : 'Inativo'" />
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="5">Nenhum produto cadastrado.</td>
            </tr>
          }
        </tbody>
      </table>
      <p-tag class="btn" icon="pi pi-search" severity="info" value="Visualizar Todos" routerLink="/produtos"/>
    </div>
  </div>
</div>